<!DOCTYPE html>
<html>
  <head>
    <title>Khan Academy Challenge Framework</title>
    <link rel="stylesheet" type="text/css" href="scss/output.css">
    <style type="text/css" media="screen">
    #editor {
        position: relative;
        height: 300px;
        width: 100%;
/*        top: 0;
        right: 0;
        bottom: 0;
        left: 0;*/
    }
  </style>
  </head>
  <body>
    <div class="title">khan academy challenge</div>
    <div>We'd like to be able to have a few testing APIs to work with, namely:</div>

    <ul>

      <li>A whitelist of specific functionality. For example, the ability to say "This program MUST use a 'for loop' and a 'variable declaration'."</li>

      <li>A blacklist of specific functionality. For example, the ability to say "This program MUST NOT use a 'while loop' or an 'if statement'."</li>


      <li>Determine the rough structure of the program. For example, "There should be a 'for loop' and inside of it there should be an 'if statement'."</li>

    </ul>

    <ul>
      <!-- instead of adding in notifications here, we can input them into the function and append it to our ul -->
      <li class="for">Great job!  We input a for loop!</li>
      <li class="var">Good going!  We have a variable declaration!</li>
      <li class="while">We're trying to avoid while loops! Please remove!</li>
      <li class="if">Let's stray away from 'if' statements! Please remove!</li>
      <li class="roughStructure">There is no if statement within a for loop!</li>
    </ul>
    <div id="editor">function foo(items) {
  for (var i = 0; i < 5; i++) {
    console.log(i);
  }
}</div>
    <div class="output"></div>
    <script src="https://code.jquery.com/jquery-2.2.1.js" integrity="sha256-eNcUzO3jsv0XlJLveFEkbB8bA7/CroNpNVk3XpmnwHc=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="src/ace/src-min-noconflict/ace.js"></script>
    <script type="text/javascript" src="node_modules/acorn/dist/acorn.js" charset="UTF-8"></script>
    <script type="text/javascript" src="node_modules/acorn/dist/acorn_loose.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/app.js"></script>
    <script>
      //editor
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/monokai");
      editor.getSession().setMode("ace/mode/javascript");

      // console.log(editor.getValue()); // returns a string value of editor
      //to make this appear from the document.load()
      $(document).ready(function(){
        //whitelist functionality
        whiteList(getEditorCode(), 'for');
        whiteList(getEditorCode(), 'var');

        //blacklist functionality
        blackList(getEditorCode(), 'while');
        blackList(getEditorCode(), 'if');

        //rough structure
        roughStructure(getEditorCode(), ['for', 'if'], 'There is no if statement within a for loop!')
      });

      //on each key entered...
      $('#editor').keyup(function(event) {

        //whitelist functionality
        whiteList(getEditorCode(), 'for');
        whiteList(getEditorCode(), 'var');

        //blacklist functionality
        blackList(getEditorCode(), 'while');
        blackList(getEditorCode(), 'if');

        //determine rough structure of program
        roughStructure(getEditorCode(), ['for', 'if'], 'There is no if statement within a for loop!')
      });

      function getEditorCode() {
        //get input in text editor
        var textEditor = editor.getValue();

        return textEditor;
      }

      //whitelist testing
      function whiteList(editorCode, codeSearchFor) {
        return testingCode(editorCode, codeSearchFor);
      }

      //blacklist testing
      function blackList(editorCode, codeSearchFor) {
        return testingCode(editorCode, codeSearchFor);
      }

      //determine rough structure
      function roughStructure(editorCode, arrCodeSearchFor, message) {
        var structuralIntegrity = true;
        for (var i = 0; i < arrCodeSearchFor.length; i++) {
          if (editorCode.search(arrCodeSearchFor[i]) == -1) {
            structuralIntegrity = false;
          }
        }

        if (!structuralIntegrity) {
          console.log(message, 'structural integrity is false');
          var notification = document.getElementsByClassName('roughStructure');
          if (notification[0].style.display = 'none') {
            notification[0].style.display = 'block';
          }
        } else {
          var notification = document.getElementsByClassName('roughStructure');
          if (notification[0].style.display = 'block') {
            notification[0].style.display = 'none';
          }
        }
      }

      // default testing our code function
      function testingCode(editorCode, codeSearchFor) {
        var notification = document.getElementsByClassName(codeSearchFor);

        //go through splitWords and if we find codeSearchFor, then show notification
        if (editorCode.search(codeSearchFor) !== -1) {
          if (notification[0].style.display = 'none') {
            notification[0].style.display = 'block';
          }
        //go through splitWords and if we DON'T find codeSearchFor, then hide the notification
        } else {
          if (notification[0].style.display = 'block') {
            notification[0].style.display = 'none';
          }
        }
      }
    </script>
  </body>
</html>
