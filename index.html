<!DOCTYPE html>
<html>
  <head>
    <title>Khan Academy Challenge Framework</title>
    <link rel="stylesheet" type="text/css" href="scss/output.css">
    <style type="text/css" media="screen">
    #editor {
        position: relative;
        height: 300px;
        width: 100%;
/*        top: 0;
        right: 0;
        bottom: 0;
        left: 0;*/
    }
  </style>
  </head>
  <body>
    <div class="title">khan academy challenge</div>
    <div>We'd like to be able to have a few testing APIs to work with, namely:</div>

    <ul>

      <li>A whitelist of specific functionality. For example, the ability to say "This program MUST use a 'for loop' and a 'variable declaration'."</li>

      <li>A blacklist of specific functionality. For example, the ability to say "This program MUST NOT use a 'while loop' or an 'if statement'."</li>


      <li>Determine the rough structure of the program. For example, "There should be a 'for loop' and inside of it there should be an 'if statement'."</li>

    </ul>

    <ul>
      <!-- instead of adding in notifications here, we can input them into the function and append it to our ul -->
      <li class="for">Great job!  We input a for loop!</li>
      <li class="var">Good going!  We have a variable declaration!</li>
      <li class="while">We're trying to avoid while loops! Please remove!</li>
      <li class="if">Let's stray away from 'if' statements! Please remove!</li>
      <li class="roughStructure">There is no if statement within a for loop!</li>
    </ul>
    <div id="editor">function foo(items) {
  for (var i = 0; i < 5; i++) {
    for (var j = 0; j < 5; j++) {
      if ('lol' == 'lol') {
        console.log('lolol!!')
        if ('lolool' == 'lolool') {
          console.log('lololol!!!');
        }
      }
      console.log(j);
    }
    console.log(i);
  }
  if ('test' === 'test') {
    console.log('lol');
  }
  if ('test' === 'test') {
    console.log('lol');
  }
}</div>
    <div class="output"></div>
    <script src="https://code.jquery.com/jquery-2.2.1.js" integrity="sha256-eNcUzO3jsv0XlJLveFEkbB8bA7/CroNpNVk3XpmnwHc=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="src/ace/src-min-noconflict/ace.js"></script>
    <script type="text/javascript" src="node_modules/acorn/dist/acorn.js" charset="UTF-8"></script>
    <script type="text/javascript" src="node_modules/acorn/dist/acorn_loose.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/app.js"></script>
    <script>
      'use strict';
      //editor
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/monokai");
      editor.getSession().setMode("ace/mode/javascript");

      //acorn parser
      var tokens = [];
      var acEx = acorn.parse(editor.getValue());
      console.log('acorn example: ', acEx);

      //global var to hold tree types
      // var treeTypes = [];

      //depth first search
      //var treeTypes = [];
      function goThroughTree(tree) {
        var treeTypes = [];

        function parseTree(tree) {
          //local var to hold the types in our tree

          var current = tree;

          //parse through tree
          while (current.body || current.consequent) {

            current = current.body || current.consequent;
            console.log("current is: ", current);

            if (Array.isArray(current)) {
              for (var i = 0; i < current.length; i++) {
                console.log('parseTree is triggered with: ', current[i]);
                parseTree(current[i]);
                treeTypes.push(current[i].type);
              }
            }


            if (current.type) {
              console.log('current.type is: ', current.type);
              treeTypes.push(current.type);
            }

          }
          //go through and get every node type and then create a new hash and push the hash into the arr
          // return treeTypes;

        }

        parseTree(tree);

        return treeTypes;

      }
      //can do acEx.type to get what type it is. root of BT is 'Program'
      //'BlockStatement' is anything enclosed in {}

      //acEx.type ==> 'Program'
      //acEx.body[0].type ==> 'FunctionDeclaration'
        //acEx.body[0].body.type ==> 'BlockStatement'
          //acEx.body[0].body.body[0].type ==> 'ForStatement'
            //acEx.body[0].body.body[0].body.type ==> 'BlockStatement'
              //acEx.body[0].body.body[0].body.body[1].type ==> 'ExpressionStatement'... this is console.log(i)

              //acEx.body[0].body.body[0].body.body[0].type ==> 'ForStatement'
                //acEx.body[0].body.body[0].body.body[0].body.type ==> 'BlockStatement'
                  //acEx.body[0].body.body[0].body.body[0].body.body[0].type ==> 'ExpressionStatement'... this is console.log(j)

      //**to find arguments, can call acEx.body[0].body.body[0].body.body[0].body.body[0].expression.arguments[0].name ==> "j"**

      //========
      //THIS NEXT NODE IS WHERE THE BRANCH ENDS ON THE TREE!!!!!! THERE'S NO MORE 'BODY' THAT CAN BE CALLED AFTER acEx.body[0].body.body[0].body.body[1]
      //========

        //to find args, can call acEx.body[0].body.body[0].body.body[1].expression.arguments[0].name ==> 'i'


      // 2nd two nodes in acEx.body[0].body are if statement
      //acEx.body[0].body.body[1].type ==> 'IfStatement'
        //acEx.body[0].body.body[1].consequent.type ==> "BlockStatement"
          //acEx.body[0].body.body[1].consequent.body[0].type ==> "ExpressionStatement"

      //acEx.body[0].body.body[2].type ==> 'IfStatement'
        //acEx.body[0].body.body[2].consequent.type ==> "BlockStatement"
          //acEx.body[0].body.body[2].consequent.body[0].type ==> "ExpressionStatement"



      //** WILL ALWAYS BE BODY[index] FOLLOWED BY BODY (BLOCK STATEMENT) FOLLOWED BY BODY[index]



      console.log('acorn getting for loop: ', acEx.body[0].body.body[0].type);

      // console.log(editor.getValue()); // returns a string value of editor
      //to make this appear from the document.load()
      $(document).ready(function(){

        //whitelist functionality
        api.whiteList(getEditorCode(), 'for');
        api.whiteList(getEditorCode(), 'var');

        //blacklist functionality
        api.blackList(getEditorCode(), 'while');
        api.blackList(getEditorCode(), 'if');

        //rough structure
        api.roughStructure(getEditorCode(), ['for', 'if'], 'There is no if statement within a for loop!')
      });

      //on each key entered...
      $('#editor').keyup(function(event) {

        //whitelist functionality
        api.whiteList(getEditorCode(), 'for');
        api.whiteList(getEditorCode(), 'var');

        //blacklist functionality
        api.blackList(getEditorCode(), 'while');
        api.blackList(getEditorCode(), 'if');

        //determine rough structure of program
        api.roughStructure(getEditorCode(), ['for', 'if'], 'There is no if statement within a for loop!')
      });

      function getEditorCode() {
        //get input in text editor
        var textEditor = editor.getValue();

        return textEditor;
      }

      var api = {
      //whitelist testing
        whiteList: function(editorCode, codeSearchFor) {
          return this.testingCode(editorCode, codeSearchFor);
        },
        //blacklist testing
        blackList: function(editorCode, codeSearchFor) {
          return this.testingCode(editorCode, codeSearchFor);
        },

        //determine rough structure
        roughStructure: function(editorCode, arrCodeSearchFor, message) {
          var structuralIntegrity = true;
          for (var i = 0; i < arrCodeSearchFor.length; i++) {
            if (editorCode.search(arrCodeSearchFor[i]) == -1) {
              structuralIntegrity = false;
            }
          }

          if (!structuralIntegrity) {
            // console.log(message, 'structural integrity is false');
            var notification = document.getElementsByClassName('roughStructure');
            if (notification[0].style.display = 'none') {
              notification[0].style.display = 'block';
            }
          } else {
            var notification = document.getElementsByClassName('roughStructure');
            if (notification[0].style.display = 'block') {
              notification[0].style.display = 'none';
            }
          }
        },

        // default testing our code function
        testingCode: function(editorCode, codeSearchFor) {
          var notification = document.getElementsByClassName(codeSearchFor);

          //go through splitWords and if we find codeSearchFor, then show notification
          if (editorCode.search(codeSearchFor) !== -1) {
            if (notification[0].style.display = 'none') {
              notification[0].style.display = 'block';
            }
          //go through splitWords and if we DON'T find codeSearchFor, then hide the notification
          } else {
            if (notification[0].style.display = 'block') {
              notification[0].style.display = 'none';
            }
          }
        }
      }
    </script>
  </body>
</html>
